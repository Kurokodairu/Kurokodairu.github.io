import C from"./Chlul9kl.js";import{u as I,a as g,b as M,_ as B}from"./DAR6fcUo.js";import{E as N,d as w,x as h,y as d,z as e,A as S,F as a,B as k,D as A,G as P,H as L,I as D,J as y,K as b,L as $,o as F}from"./Dp4WoKgW.js";import{u as H}from"./B45o0bh_.js";import"./rZAoiaVv.js";const E=()=>{const{user:r,points:s,updatePoints:u}=I(),c=N(),i=[{title:"1",description:"Koster bare en.",points:1,image:"üî•"},{title:"Meditation Cushion",description:"Comfortable meditation cushion to enhance your mindfulness practice.",points:150,image:"ü™ë"},{title:"Essential Oils Set",description:"Complete set of essential oils for aromatherapy and relaxation.",points:300,image:"üåø"},{title:"Fitness Tracker",description:"Smart fitness tracker to monitor your wellness journey and progress.",points:500,image:"‚åö"}],o=n=>r.value&&s.value>=n.points,t=async n=>{var _;if(!((_=r.value)!=null&&_.id))throw new Error("User not authenticated");const{data:p,error:m}=await c.from("redeems").insert([{redeemer_id:r.value.id,redeem_item:n.title}]);if(m)throw console.error("Error recording purchase:",m),m;return p};return{shopItems:i,canPurchase:o,purchaseItem:async n=>{if(!r.value)return g().show("Du m√• v√¶re logget inn for √• kj√∏pe varer","error"),!1;if(s.value<n.points)return g().show("Du har ikke nok poeng for √• kj√∏pe denne varen","warning"),!1;try{return await u(-n.points),await t(n),g().show(`Du har kj√∏pt ${n.title}!`,"success"),!0}catch(p){return console.error("Error purchasing item:",p),g().show("Feil ved kj√∏p av vare","error"),!1}},recordPurchase:t,getPurchaseHistory:async()=>{var m;if(!((m=r.value)!=null&&m.id))return[];const{data:n,error:p}=await c.from("redeems").select("*").eq("redeemer_id",r.value.id).order("created_at",{ascending:!1});return p?(console.error("Error fetching purchase history:",p),[]):n||[]}}},T={class:"shop-card"},V={class:"shop-card-content"},z={class:"shop-card-icon"},K={class:"shop-card-title"},R={class:"shop-card-description"},U={class:"shop-card-price"},q={class:"price-amount"},G=["disabled"],J=w({__name:"ShopCard",props:{item:{}},emits:["purchase"],setup(r,{emit:s}){const u=r,c=s,{canPurchase:i}=E(),o=()=>{c("purchase",u.item)};return(t,l)=>{const f=C;return d(),h("div",T,[e("div",V,[e("div",z,S(t.item.image),1),e("h3",K,S(t.item.title),1),e("p",R,S(t.item.description),1),e("div",U,[e("span",q,S(t.item.points),1),l[0]||(l[0]=e("span",{class:"price-label"},"points",-1))]),e("button",{class:"shop-card-btn",disabled:!a(i)(t.item),onClick:o},[k(f,{name:"lucide:shopping-cart"}),l[1]||(l[1]=A(" Redeem "))],8,G)])])}}}),O={class:"shop-container"},Q={class:"shop-wrapper"},W={class:"shop-grid"},X=w({__name:"ShopSection",setup(r){const{shopItems:s,purchaseItem:u}=E(),c=async i=>{console.log("Purchase button clicked for item:",i);const o=await u(i);console.log("Purchase result:",o)};return(i,o)=>{const t=J;return d(),h("div",O,[e("div",Q,[o[0]||(o[0]=e("h2",{class:"shop-title"},"Shop",-1)),e("div",W,[(d(!0),h(P,null,L(a(s),l=>(d(),D(t,{key:l.title,item:l,onPurchase:c},null,8,["item"]))),128))])])])}}}),Y={id:"sessions"},Z={class:"sessions-header"},ee={class:"sessions-title"},se={class:"sessions-actions"},oe={class:"session-list"},te={key:0,style:{color:"#888"}},ne={class:"session-delete-row"},re=w({__name:"SessionsSection",setup(r){const{isLoggedIn:s,logout:u}=I(),{recentSessions:c,isLoading:i}=M(),o=y("modals.mySessions",()=>!1),t=y("modals.addSession",()=>!1),l=y("modals.deleteSession",()=>!1),f=()=>{if(!s.value){g().show("Logg inn f√∏rst","error");return}o.value=!0},n=()=>{if(!s.value){g().show("Logg inn f√∏rst","error");return}t.value=!0},p=()=>{if(!s.value){g().show("Logg inn f√∏rst","error");return}l.value=!0};return(m,_)=>{const j=C,x=B;return d(),h("section",Y,[e("div",Z,[e("div",ee,[k(j,{name:"lucide:calendar-clock"}),_[1]||(_[1]=e("h2",null,"Ukas √∏kter",-1))]),e("div",se,[e("button",{class:b(["sessions-tab active",{"is-disabled":!a(s)}]),onClick:f}," Mine √∏kter ",2),e("button",{class:b(["add-session-btn",{"is-disabled":!a(s)}]),onClick:n}," Legg til √∏kt ",2)])]),e("ul",oe,[(d(!0),h(P,null,L(a(c),v=>(d(),D(x,{key:v.id,session:v},null,8,["session"]))),128)),a(c).length===0&&!a(i)?(d(),h("li",te," Ingen √∏kter funnet. ")):$("",!0)]),e("div",ne,[e("button",{class:b(["delete-session-trigger",{"is-disabled":!a(s)}]),onClick:p}," Slett √∏kt ",2),a(s)?(d(),h("button",{key:0,class:"delete-session-trigger",onClick:_[0]||(_[0]=(...v)=>a(u)&&a(u)(...v))}," Logg ut ")):$("",!0)])])}}}),ue=w({__name:"index",setup(r){H({title:"Treningslogg",meta:[{name:"description",content:"Treningslogg"}]});const{fetchRecentSessions:s}=M();return F(()=>{s()}),(u,c)=>{const i=X,o=re;return d(),h("div",null,[k(i),k(o)])}}});export{ue as default};
