import{I as C,Z as F,$ as O,k as b,a0 as $,a1 as S,q,r as L,d as B,x as _,y as D,z as w,K as E,J as I,E as y,A as m,D as P}from"./jNFdvCw9.js";const o=()=>{const c=C("notifications",()=>[]);return{show:(i,t="info",d=5e3)=>{const g=new Date().toISOString();console[t==="error"?"error":t==="warning"?"warn":"info"](`[${g}] ${t.toUpperCase()}: ${i}`);const f={id:Date.now()+Math.random(),message:i,type:t,duration:d};c.value.push(f);try{const n=JSON.parse(localStorage.getItem("app-notifications")||"[]");n.push({timestamp:g,type:t,message:i}),n.length>100&&n.splice(0,n.length-100),localStorage.setItem("app-notifications",JSON.stringify(n))}catch(n){console.warn("Failed to store notification log:",n)}},getLogs:()=>{try{return JSON.parse(localStorage.getItem("app-notifications")||"[]")}catch(i){return console.warn("Failed to retrieve notification logs:",i),[]}return[]},clearLogs:()=>{localStorage.removeItem("app-notifications")}}},N=()=>{const c=F(),r=O(),l=C("user.points",()=>0),v=b(()=>!!r.value),i=async e=>{var n,h;if(!e&&!((n=r.value)!=null&&n.id)){l.value=0;return}const f=e||((h=r.value)==null?void 0:h.id);if(f)try{const{data:p,error:k}=await c.from("users").select("points").eq("id",f).single();!k&&p&&(l.value=Number(p.points)||0)}catch(p){console.error("Error fetching points:",p),l.value=0}},t=async e=>{var f;if(!((f=r.value)!=null&&f.id)){o().show("Du må være logget inn for å oppdatere poeng","error");return}try{const h=l.value+e,{error:p}=await c.from("users").update({points:h}).eq("id",r.value.id);p?(console.error("Error updating points:",p.message),o().show("Feil ved oppdatering av poeng.","error")):(l.value=h,o().show(e>0?`+${e} poeng`:`${e} poeng`,e>0?"success":"warning"))}catch(n){console.error("Error updating points:",n),o().show("Feil ved oppdatering av poeng.","error")}},d=async()=>{try{const{error:e}=await c.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}});e&&(console.error("Login error:",e.message),o().show("Login feil: "+e.message,"error"))}catch(e){console.error("Login error:",e),o().show("Login feil","error")}},g=async()=>{try{const{error:e}=await c.auth.signOut();e?(console.error("Logout error:",e.message),o().show("Logout feil: "+e.message,"error")):(l.value=0,await q("/"))}catch(e){console.error("Logout error:",e),o().show("Logout feil","error")}};return $(()=>{var e;(e=r.value)!=null&&e.id?i(r.value.id):l.value=0}),{user:S(r),points:S(l),isLoggedIn:v,updatePointDisplay:i,updatePoints:t,loginWithGoogle:d,logout:g}},A=()=>{const c=F(),{user:r}=N(),{updatePoints:l}=N(),v=L([]),i=L([]),t=L(!1),d=async()=>{t.value=!0;try{const s=new Date;s.setDate(s.getDate()-7);const{data:u,error:a}=await c.from("sessions").select("*, users(name)").gte("created_at",s.toISOString()).order("created_at",{ascending:!1});if(a){console.error("Error fetching recent sessions:",a.message);return}v.value=u||[]}catch(s){console.error("Error fetching recent sessions:",s)}finally{t.value=!1}},g=async()=>{var s;if(!((s=r.value)!=null&&s.id)){i.value=[];return}t.value=!0;try{const{data:u,error:a}=await c.from("sessions").select("*, users(name)").eq("user_id",r.value.id).order("created_at",{ascending:!1});if(a){console.error("Error fetching my sessions:",a.message);return}i.value=u||[]}catch(u){console.error("Error fetching my sessions:",u)}finally{t.value=!1}},e=async s=>{var u;if(!((u=r.value)!=null&&u.id))return o().show("Du må være logget inn for å legge til økt","error"),!1;try{const{error:a}=await c.from("sessions").insert([{user_id:r.value.id,title:s.title,desc:s.desc,type:s.type,varighet:s.varighet}]);return a?(o().show("Feil ved lagring av økt: "+a.message,"error"),!1):(await l(1),await d(),await g(),o().show("Økt lagt til!","success"),!0)}catch(a){return console.error("Error adding session:",a),o().show("Feil ved lagring av økt","error"),!1}},f=async s=>{var u;if(!((u=r.value)!=null&&u.id))return o().show("Du må være logget inn for å slette økt","error"),!1;try{const{error:a}=await c.from("sessions").delete().eq("id",s).eq("user_id",r.value.id);return a?(o().show("Feil ved sletting av økt: "+a.message,"error"),!1):(await d(),await g(),o().show("Økt slettet!","success"),!0)}catch(a){return console.error("Error deleting session:",a),o().show("Feil ved sletting av økt","error"),!1}},n=s=>{if(!s)return{class:"annet",label:"Annet"};switch(s.toLowerCase()){case"pilates":return{class:"pilates",label:"Pilates"};case"vann":return{class:"vann",label:"Vann"};case"styrke":return{class:"styrke",label:"Styrke"};default:return{class:"annet",label:"Annet"}}},h=s=>{if(!s)return"annet";switch(s.toLowerCase()){case"pilates":return"pilates";case"vann":return"vann";case"styrke":return"styrke";default:return"annet"}},p=s=>new Date(s).toLocaleDateString("no-NO",{day:"numeric",month:"short",year:"numeric"}),k=s=>s?typeof s=="number"?`${s} min`:`${s}`:"";return{recentSessions:S(v),mySessions:S(i),isLoading:S(t),fetchRecentSessions:d,fetchMySessions:g,addSession:e,deleteSession:f,getTypeBadge:n,getDotClass:h,formatDate:p,formatDuration:k}},T={class:"session-meta"},J={class:"session-date"},V={key:0,class:"session-divider"},U={key:1,class:"session-duration"},W={class:"session-id"},z={class:"session-desc"},G=B({__name:"SessionItem",props:{session:{}},setup(c){const r=c,{getTypeBadge:l,getDotClass:v,formatDate:i,formatDuration:t}=A(),d=b(()=>l(r.session.type)),g=b(()=>{var e;return((e=r.session.users)==null?void 0:e.name)||"Bruker"});return(e,f)=>(D(),_("li",null,[w("div",T,[w("span",{class:I(["session-dot",y(v)(e.session.type)])},null,2),w("span",J,m(y(i)(e.session.created_at)),1),e.session.varighet?(D(),_("span",V,"•")):E("",!0),e.session.varighet?(D(),_("span",U,m(y(t)(e.session.varighet)),1)):E("",!0),w("div",W,m(e.session.id),1)]),w("div",z,[P(" ["+m(y(g))+"] "+m(e.session.title)+m(e.session.desc?": "+e.session.desc:"")+" ",1),w("span",{class:I(["session-badge",y(d).class])},m(y(d).label),3)])]))}});export{G as _,o as a,A as b,N as u};
