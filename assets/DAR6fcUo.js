import{J as L,E as C,$ as F,k as b,a0 as O,a1 as k,q as P,d as $,x as _,y as D,z as y,L as E,K as I,F as S,A as w,D as q}from"./Dp4WoKgW.js";const t=()=>{const c=L("notifications",()=>[]);return{show:(n,a="info",g=5e3)=>{const f=new Date().toISOString();console[a==="error"?"error":a==="warning"?"warn":"info"](`[${f}] ${a.toUpperCase()}: ${n}`);const s={id:Date.now()+Math.random(),message:n,type:a,duration:g};c.value.push(s);try{const i=JSON.parse(localStorage.getItem("app-notifications")||"[]");i.push({timestamp:f,type:a,message:n}),i.length>100&&i.splice(0,i.length-100),localStorage.setItem("app-notifications",JSON.stringify(i))}catch(i){console.warn("Failed to store notification log:",i)}},getLogs:()=>{try{return JSON.parse(localStorage.getItem("app-notifications")||"[]")}catch(n){return console.warn("Failed to retrieve notification logs:",n),[]}return[]},clearLogs:()=>{localStorage.removeItem("app-notifications")}}},N=()=>{const c=C(),r=F(),u=L("user.points",()=>0),v=b(()=>!!r.value),n=L("user.loadedUserId",()=>null),a=async s=>{var m,h;if(!s&&!((m=r.value)!=null&&m.id)){u.value=0;return}const i=s||((h=r.value)==null?void 0:h.id);if(i)try{const{data:p,error:e}=await c.from("users").select("points").eq("id",i).single();!e&&p&&(u.value=Number(p.points)||0)}catch(p){console.error("Error fetching points:",p),u.value=0}},g=async s=>{var i;if(!((i=r.value)!=null&&i.id)){t().show("Du må være logget inn for å oppdatere poeng","error");return}try{const h=u.value+s,{error:p}=await c.from("users").update({points:h}).eq("id",r.value.id);p?(console.error("Error updating points:",p.message),t().show("Feil ved oppdatering av poeng.","error")):(u.value=h,t().show(s>0?`+${s} poeng`:`${s} poeng`,s>0?"success":"warning"))}catch(m){console.error("Error updating points:",m),t().show("Feil ved oppdatering av poeng.","error")}},f=async()=>{try{const{error:s}=await c.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}});s&&(console.error("Login error:",s.message),t().show("Login feil: "+s.message,"error"))}catch(s){console.error("Login error:",s),t().show("Login feil","error")}},o=async()=>{try{const{error:s}=await c.auth.signOut();s?(console.error("Logout error:",s.message),t().show("Logout feil: "+s.message,"error")):(u.value=0,await P("/"))}catch(s){console.error("Logout error:",s),t().show("Logout feil","error")}};return O(()=>{var s;(s=r.value)!=null&&s.id?n.value!==r.value.id&&(n.value=r.value.id,a(r.value.id)):(u.value=0,n.value=null)}),{user:k(r),points:k(u),isLoggedIn:v,updatePointDisplay:a,updatePoints:g,loginWithGoogle:f,logout:o}},B=()=>{const c=C(),{user:r}=N(),{updatePoints:u}=N(),v=L("sessions.recent",()=>[]),n=L("sessions.mine",()=>[]),a=L("sessions.loading",()=>!1),g=async()=>{if(!a.value){a.value=!0;try{const e=new Date;e.setDate(e.getDate()-7);const{data:d,error:l}=await c.from("sessions").select("*, users(name)").gte("created_at",e.toISOString()).order("created_at",{ascending:!1});if(l){console.error("Error fetching recent sessions:",l.message);return}v.value=d||[]}catch(e){console.error("Error fetching recent sessions:",e)}finally{a.value=!1}}},f=async()=>{var e;if(!((e=r.value)!=null&&e.id)){n.value=[];return}try{const{data:d,error:l}=await c.from("sessions").select("*, users(name)").eq("user_id",r.value.id).order("created_at",{ascending:!1});if(l){console.error("Error fetching my sessions:",l.message);return}n.value=d||[]}catch(d){console.error("Error fetching my sessions:",d)}},o=async e=>{var d;if(!((d=r.value)!=null&&d.id))return t().show("Du må være logget inn for å legge til økt","error"),!1;try{const{error:l}=await c.from("sessions").insert([{user_id:r.value.id,title:e.title,desc:e.desc,type:e.type,varighet:e.varighet}]);return l?(t().show("Feil ved lagring av økt: "+l.message,"error"),!1):(await u(1),await Promise.all([g(),f()]),t().show("Økt lagt til!","success"),!0)}catch(l){return console.error("Error adding session:",l),t().show("Feil ved lagring av økt","error"),!1}},s=async e=>{var d;if(!((d=r.value)!=null&&d.id))return t().show("Du må være logget inn for å slette økt","error"),!1;try{const{error:l}=await c.from("sessions").delete().eq("id",e).eq("user_id",r.value.id);return l?(t().show("Feil ved sletting av økt: "+l.message,"error"),!1):(await Promise.all([g(),f()]),t().show("Økt slettet!","success"),!0)}catch(l){return console.error("Error deleting session:",l),t().show("Feil ved sletting av økt","error"),!1}},i=e=>{if(!e)return{class:"annet",label:"Annet"};switch(e.toLowerCase()){case"pilates":return{class:"pilates",label:"Pilates"};case"vann":return{class:"vann",label:"Vann"};case"styrke":return{class:"styrke",label:"Styrke"};default:return{class:"annet",label:"Annet"}}},m=e=>{if(!e)return"annet";switch(e.toLowerCase()){case"pilates":return"pilates";case"vann":return"vann";case"styrke":return"styrke";default:return"annet"}},h=e=>new Date(e).toLocaleDateString("no-NO",{day:"numeric",month:"short",year:"numeric"}),p=e=>e?typeof e=="number"?`${e} min`:`${e}`:"";return{recentSessions:k(v),mySessions:k(n),isLoading:k(a),fetchRecentSessions:g,fetchMySessions:f,addSession:o,deleteSession:s,getTypeBadge:i,getDotClass:m,formatDate:h,formatDuration:p}},A={class:"session-meta"},T={class:"session-date"},U={key:0,class:"session-divider"},J={key:1,class:"session-duration"},V={class:"session-id"},W={class:"session-desc"},M=$({__name:"SessionItem",props:{session:{}},setup(c){const r=c,{getTypeBadge:u,getDotClass:v,formatDate:n,formatDuration:a}=B(),g=b(()=>u(r.session.type)),f=b(()=>{var o;return((o=r.session.users)==null?void 0:o.name)||"Bruker"});return(o,s)=>(D(),_("li",null,[y("div",A,[y("span",{class:I(["session-dot",S(v)(o.session.type)])},null,2),y("span",T,w(S(n)(o.session.created_at)),1),o.session.varighet?(D(),_("span",U,"•")):E("",!0),o.session.varighet?(D(),_("span",J,w(S(a)(o.session.varighet)),1)):E("",!0),y("div",V,w(o.session.id),1)]),y("div",W,[q(" ["+w(S(f))+"] "+w(o.session.title)+w(o.session.desc?": "+o.session.desc:"")+" ",1),y("span",{class:I(["session-badge",S(g).class])},w(S(g).label),3)])]))}});export{M as _,t as a,B as b,N as u};
